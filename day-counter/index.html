<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>日数カウントダウン</title>
  <style>
    :root {
      --bg-1: #0f172a;
      --bg-2: #0b213d;
      --panel: rgba(255, 255, 255, 0.08);
      --border: rgba(255, 255, 255, 0.16);
      --text-main: #e2e8f0;
      --muted: #94a3b8;
      --accent: #22d3ee;
      --accent-2: #f472b6;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 40px 16px;
      font-family: "Avenir Next", "Futura", "Hiragino Sans", "Noto Sans JP", sans-serif;
      color: var(--text-main);
      background: radial-gradient(120% 120% at 20% 20%, rgba(34, 211, 238, 0.18), transparent 55%),
                  radial-gradient(140% 140% at 80% 0%, rgba(244, 114, 182, 0.20), transparent 50%),
                  linear-gradient(160deg, var(--bg-1), var(--bg-2));
    }

    main {
      width: min(960px, 94vw);
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: 24px;
      padding: 28px;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.32);
      backdrop-filter: blur(12px);
    }

    h1 {
      font-weight: 700;
      letter-spacing: 0.04em;
      margin: 0 0 12px;
    }

    .lead {
      color: var(--muted);
      margin: 0 0 28px;
      line-height: 1.6;
    }

    .panel {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 18px;
      align-items: end;
      margin-bottom: 26px;
    }

    label {
      display: block;
      font-size: 14px;
      color: var(--muted);
      margin-bottom: 6px;
      letter-spacing: 0.02em;
    }

    input, button {
      width: 100%;
      border-radius: 12px;
      border: 1px solid var(--border);
      background: rgba(255, 255, 255, 0.04);
      color: var(--text-main);
      padding: 12px 14px;
      font-size: 16px;
      transition: border-color 0.2s ease, transform 0.2s ease, box-shadow 0.2s ease;
    }

    input:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(34, 211, 238, 0.2);
    }

    button {
      cursor: pointer;
      background: linear-gradient(135deg, var(--accent), var(--accent-2));
      border: none;
      font-weight: 700;
      letter-spacing: 0.03em;
      box-shadow: 0 14px 30px rgba(34, 211, 238, 0.35);
    }

    button:hover { transform: translateY(-1px); }
    button:active { transform: translateY(0); }

    .result {
      margin-top: 10px;
      padding: 20px;
      border-radius: 18px;
      border: 1px dashed var(--border);
      background: rgba(255, 255, 255, 0.03);
    }

    .result .big {
      font-size: clamp(32px, 4vw + 10px, 60px);
      font-weight: 800;
      margin: 0 0 6px;
    }

    .muted {
      color: var(--muted);
      font-size: 14px;
      margin: 0;
    }

    .stamp-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: 12px;
      margin-top: 16px;
    }

    .stamp {
      padding: 14px;
      border-radius: 12px;
      border: 1px solid var(--border);
      background: rgba(255, 255, 255, 0.02);
    }

    .stamp-label {
      margin: 0 0 6px;
      font-size: 13px;
      letter-spacing: 0.02em;
      color: var(--muted);
    }

    .stamp-value {
      margin: 0;
      font-size: clamp(20px, 1.2vw + 14px, 30px);
      font-weight: 700;
      letter-spacing: 0.02em;
    }

    .milestones {
      margin-top: 18px;
      padding: 18px;
      border-radius: 16px;
      border: 1px dashed var(--border);
      background: rgba(255, 255, 255, 0.025);
    }

    .section-title {
      margin: 0 0 10px;
      font-weight: 700;
      letter-spacing: 0.03em;
    }

    .milestone-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 10px;
    }

    .milestone-card {
      padding: 12px;
      border-radius: 12px;
      border: 1px solid var(--border);
      background: rgba(255, 255, 255, 0.02);
    }

    .stamp-line {
      display: flex;
      align-items: baseline;
      gap: 10px;
      flex-wrap: wrap;
    }

    .milestone-days {
      margin: 0;
      font-size: clamp(18px, 1.5vw + 12px, 24px);
      color: var(--accent);
      font-weight: 700;
      letter-spacing: 0.02em;
    }

    .milestone-days.past-day {
      color: var(--muted);
    }

    .alert-red {
      color: #f87171;
      animation: alert-blink 1s ease-in-out infinite;
    }
    .alert-yellow {
      color: #facc15;
      animation: alert-blink 1s ease-in-out infinite;
    }

    .rainbow {
      background: linear-gradient(90deg, #f472b6, #f59e0b, #22d3ee, #a78bfa, #f472b6);
      background-size: 200% 200%;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      animation: rainbow-move 4s ease infinite;
    }

    @keyframes rainbow-move {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    @keyframes alert-blink {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.55; }
    }

    .tiny {
      font-size: 12px;
      color: var(--muted);
      margin-top: 6px;
      line-height: 1.4;
    }

    @media (max-width: 600px) {
      main { padding: 22px; }
    }
  </style>
</head>
<body>
  <main>
    <h1>目標日まであと何日？</h1>
    <p class="lead">日付と時間を入力すると、今この瞬間からの残り日数をカウントします。ブラウザのタイムゾーンで計算しています。</p>

    <div class="panel">
      <div>
        <label for="targetDate">目標の日付</label>
        <input type="date" id="targetDate">
      </div>
      <div>
        <label for="targetTime">目標の時間</label>
        <input type="time" id="targetTime" value="00:00">
      </div>
      <div>
        <button id="startBtn">カウント開始</button>
      </div>
    </div>

    <div class="result">
      <p class="big" id="headline">日付を入力してください</p>
      <p class="muted" id="detail"></p>
      <div class="stamp-grid">
        <div class="stamp">
          <p class="stamp-label">目標日時</p>
          <p class="stamp-value" id="targetStamp">--</p>
        </div>
        <div class="stamp">
          <p class="stamp-label">現在</p>
          <p class="stamp-value" id="nowStamp">--</p>
        </div>
      </div>
      <p class="tiny" id="status"></p>
    </div>

    <div class="milestones">
      <p class="section-title">目標日の前倒しチェック</p>
      <div class="milestone-grid">
        <div class="milestone-card">
          <p class="stamp-label">64日前</p>
          <div class="stamp-line">
            <p class="stamp-value" id="m64">--</p>
            <p class="milestone-days" id="m64d">--</p>
          </div>
        </div>
        <div class="milestone-card">
          <p class="stamp-label">32日前</p>
          <div class="stamp-line">
            <p class="stamp-value" id="m32">--</p>
            <p class="milestone-days" id="m32d">--</p>
          </div>
        </div>
        <div class="milestone-card">
          <p class="stamp-label">16日前</p>
          <div class="stamp-line">
            <p class="stamp-value" id="m16">--</p>
            <p class="milestone-days" id="m16d">--</p>
          </div>
        </div>
        <div class="milestone-card">
          <p class="stamp-label">8日前</p>
          <div class="stamp-line">
            <p class="stamp-value" id="m8">--</p>
            <p class="milestone-days" id="m8d">--</p>
          </div>
        </div>
      </div>
    </div>
  </main>

  <script>
    const dateInput = document.getElementById('targetDate');
    const timeInput = document.getElementById('targetTime');
    const headline = document.getElementById('headline');
    const detail = document.getElementById('detail');
    const status = document.getElementById('status');
    const targetStamp = document.getElementById('targetStamp');
    const nowStamp = document.getElementById('nowStamp');
    const milestoneEls = {
      64: { date: document.getElementById('m64'), days: document.getElementById('m64d') },
      32: { date: document.getElementById('m32'), days: document.getElementById('m32d') },
      16: { date: document.getElementById('m16'), days: document.getElementById('m16d') },
      8: { date: document.getElementById('m8'), days: document.getElementById('m8d') },
    };
    const startBtn = document.getElementById('startBtn');
    const dayMs = 24 * 60 * 60 * 1000;
    let timerId;

    const setDefaultDate = () => {
      const now = new Date();
      const tomorrow = new Date(now.getTime() + dayMs);
      dateInput.value = tomorrow.toISOString().split('T')[0];
    };

    const applyInitialValues = () => {
      const params = new URLSearchParams(window.location.search);
      const dateParam = params.get('date');
      const timeParam = params.get('time');
      const validDate = dateParam && /^\d{4}-\d{2}-\d{2}$/.test(dateParam) && !Number.isNaN(new Date(dateParam).getTime());
      const validTime = timeParam && /^\d{2}:\d{2}$/.test(timeParam);

      if (validDate) {
        dateInput.value = dateParam;
      } else {
        setDefaultDate();
      }

      if (validTime) {
        timeInput.value = timeParam;
      } else if (!timeInput.value) {
        timeInput.value = '00:00';
      }
    };

    const buildTargetDate = () => {
      if (!dateInput.value) return null;
      const [hour = '00', minute = '00'] = (timeInput.value || '00:00').split(':');
      const target = new Date(dateInput.value);
      if (Number.isNaN(target.getTime())) return null;
      target.setHours(Number(hour) || 0, Number(minute) || 0, 0, 0);
      return target;
    };

    const weekdays = ['日', '月', '火', '水', '木', '金', '土'];

    const setRainbow = (el, on) => {
      if (!el) return;
      el.classList.toggle('rainbow', on);
    };

    const isSameDay = (a, b) =>
      a.getFullYear() === b.getFullYear() &&
      a.getMonth() === b.getMonth() &&
      a.getDate() === b.getDate();

    const formatStamp = (date) => {
      const y = date.getFullYear();
      const m = String(date.getMonth() + 1).padStart(2, '0');
      const d = String(date.getDate()).padStart(2, '0');
      const h = String(date.getHours()).padStart(2, '0');
      const min = String(date.getMinutes()).padStart(2, '0');
      const sec = String(date.getSeconds()).padStart(2, '0');
      const weekday = weekdays[date.getDay()];
      return `${y}/${m}/${d} (${weekday}) ${h}:${min}:${sec}`;
    };

    const formatDateOnly = (date) => {
      const y = date.getFullYear();
      const m = String(date.getMonth() + 1).padStart(2, '0');
      const d = String(date.getDate()).padStart(2, '0');
      const weekday = weekdays[date.getDay()];
      return `${y}/${m}/${d} (${weekday})`;
    };

    const roundedDaysFor = (diffMs) => {
      const abs = Math.abs(diffMs);
      if (diffMs >= 0) return Math.ceil(abs / dayMs);
      return Math.floor(abs / dayMs);
    };

    const syncUrlWithInputs = () => {
      const params = new URLSearchParams(window.location.search);
      if (dateInput.value) params.set('date', dateInput.value);
      else params.delete('date');
      if (timeInput.value) params.set('time', timeInput.value);
      else params.delete('time');
      const query = params.toString();
      const newUrl = `${window.location.pathname}${query ? `?${query}` : ''}${window.location.hash}`;
      window.history.replaceState(null, '', newUrl);
    };

    const updateMilestones = (target) => {
      const milestones = [64, 32, 16, 8];
      const now = new Date();
      milestones.forEach((days) => {
        const el = milestoneEls[days];
        if (!el) return;
        if (!target) {
          el.date.textContent = '--';
          el.days.textContent = '--';
          setRainbow(el.days, false);
          el.days.classList.remove('past-day', 'alert-red', 'alert-yellow');
          return;
        }
        const date = new Date(target.getTime() - days * dayMs);
        const diffMs = date.getTime() - now.getTime();
        const roundedDays = roundedDaysFor(diffMs);
        const direction = diffMs >= 0 ? 'あと' : '経過';
        const today = isSameDay(date, now);
        const future = diffMs >= 0 && !today;
        el.date.textContent = formatDateOnly(date);
        el.days.textContent = today ? '当日！' : `${direction}${roundedDays}日`;
        setRainbow(el.days, today);
        el.days.classList.remove('past-day', 'alert-red', 'alert-yellow');
        if (today) return;
        if (future) {
          if (roundedDays <= 3) el.days.classList.add('alert-red');
          else if (roundedDays <= 7) el.days.classList.add('alert-yellow');
        } else {
          el.days.classList.add('past-day');
        }
      });
    };

    const updateCountdown = () => {
      const target = buildTargetDate();
      const now = new Date();
      if (!target) {
        headline.textContent = '日付を入力してください';
        detail.textContent = '';
        setRainbow(headline, false);
        headline.classList.remove('alert-red', 'alert-yellow');
        targetStamp.textContent = '--';
        nowStamp.textContent = formatStamp(now);
        status.textContent = 'ブラウザの時刻で計算しています';
        updateMilestones(null);
        return;
      }

      const diffMs = target.getTime() - now.getTime();
      const abs = Math.abs(diffMs);
      const roundedDays = roundedDaysFor(diffMs);
      const wholeDays = Math.floor(abs / dayMs);
      const hours = Math.floor((abs % dayMs) / (60 * 60 * 1000));
      const minutes = Math.floor((abs % (60 * 60 * 1000)) / (60 * 1000));
      const seconds = Math.floor((abs % (60 * 1000)) / 1000);
      const direction = diffMs >= 0 ? 'あと' : '経過';
      const today = isSameDay(target, now);

      headline.textContent = today ? '当日！' : `${direction}${roundedDays}日`;
      setRainbow(headline, today);
      headline.classList.remove('alert-red', 'alert-yellow');
      if (!today && diffMs >= 0) {
        if (roundedDays <= 3) headline.classList.add('alert-red');
        else if (roundedDays <= 7) headline.classList.add('alert-yellow');
      }
      detail.textContent = `${direction === 'あと' ? '残り' : '経過'} ${wholeDays}日 ${hours}時間 ${minutes}分 ${seconds}秒`;
      targetStamp.textContent = formatStamp(target);
      nowStamp.textContent = formatStamp(now);
      status.textContent = 'ブラウザの時刻で計算しています';
      updateMilestones(target);
    };

    const start = () => {
      syncUrlWithInputs();
      updateCountdown();
      clearInterval(timerId);
      timerId = setInterval(updateCountdown, 1000);
    };

    startBtn.addEventListener('click', start);
    dateInput.addEventListener('change', start);
    timeInput.addEventListener('change', start);
    window.addEventListener('focus', updateCountdown);

    applyInitialValues();
    start();
  </script>
</body>
</html>
